<table id="Manager_data"></table>

<script type="text/javascript">
var adminEditRow = undefined;    //记录当前编辑的行的索引
var adminOp;    //我们要返回到后台的值
var adminFlag;
var adminObj;    //通过这个对象来调用  adminObj.datagrid('', )   这个函数实现相关操作可以查看API寻找
var oldPwd;  //保存旧密码

adminObj = $('#Manager_data').datagrid({   
    url:'../../manfindByPage', 
    queryParams:{op:"manfindByPage"},
    fitColumns:true,
    pagination:true,
    pageSize:5,
    pageList:[5,10,15,20,25,30],
    striped:true,
    rownumbers:true,
    sortName:"wcxmid",    //按照aid进行排序
    remoteSort:false,
    fit:true,
    columns:[[   
        {checkbox:true},
        {field:'wcxmid',title:'管理员id',width:100,align:'center',sortable:true},   
        {field:'wcxmname',title:'管理员姓名',width:100,align:'center',editor:{type:"text",options:{required:true}}},
        {field:'wcxmpwd',title:'管理员密码',width:100,align:'center',editor:{type:"text",options:{required:true}}},
        {field:'wcxmemail',title:'管理员email',width:100,align:'center',editor:{type:"text",options:{required:true}}},
        {field:'wcxmalipay',title:'管理员支付宝',width:100,align:'center',editor:{type:"text",options:{required:true}}},
        {field:'wcxmpic',title:'管理员头像',width:100,align:'center',editor:{type:"text",options:{required:true}}},
        {field:'wcxqq',title:'管理员QQ',width:100,align:'center',editor:{type:"text",options:{required:true}}},
        {field:'wcxwechat',title:'管理员微信',width:100,align:'center',editor:{type:"text",options:{required:true}}},
    ]],
    toolbar: [{
    	text:"添加",
		iconCls: 'icon-user-add',
		handler: function(){
			adminOp = "addManager";
			adminFlag = "添加";
			
			if(adminEditRow != undefined){
				adminObj.datagrid("rejectChanges");    //这个意思是回滚
				adminEditRow = undefined;
			}
			adminObj.datagrid("insertRow",{index:0,row:{ } } );    //在指定位置插入行
			adminObj.datagrid("beginEdit",0);     //指定位置开始编辑
			adminEditRow = 0;
		}
	},'-',{
		text:"修改",
		iconCls: 'icon-user-edit',
		handler: function(){
			adminOp = "updateMPwd";
			adminFlag = "修改";
			
			if(adminEditRow != undefined){    //有正在被编辑的行
				adminObj.datagrid("endEdit",adminEditRow);     //结束编辑
				adminObj.datagrid("rejectChanges");
				adminEditRow = undefined;
			}
			
			var row = adminObj.datagrid("getChecked")[0];
			oldPwd = row.wcxmpwd;

			if(row == undefined){
				$.messager.show({title:'温馨提示' , msg:'请选择您要修改的管理员信息 . . . ',timeout:2000,showType:'slide'});
			}else{
				var index = adminObj.datagrid("getRowIndex",row);
				adminObj.datagrid("beginEdit",index);
				adminEditRow = index;
			}
		}
	},'-',{
		text:"保存",
		iconCls: 'icon-user-tick',
		handler: function(){
			if(adminEditRow != undefined){
				adminObj.datagrid("endEdit",adminEditRow);   //结束编辑
				//获取用户编辑的第一行
				var rows = adminObj.datagrid("getChanges")[0];
				
					console.info(rows);
				if(rows!=undefined){
					rows.op = adminOp;
					

					$.post("../../addManager",rows,function(data){
						data = parseInt( $.trim(data) );
						if(data>0){
							$.messager.show( {title:"成功提示",msg:adminFlag+"管理员信保存成功",timeout:2000,showType:'slide'} );
							adminObj.datagrid("reload");
						}else{
							$.messager.alert("失败提示",adminFlag+"管理员信息保存失败 . . .","error");
						}
					},"text");
				}
			}
		}
	},'-',{
		text:"撤销",
		iconCls: 'icon-undo',
		handler: function(){
			adminFlag = "撤销";
			
			adminObj.datagrid("endEdit",adminEditRow);   //结束编辑
			adminObj.datagrid("rejectChanges")   //回滚
		}
	}]
}); 
</script>